<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> monitoring system</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">


  <link href="assets/css/main.css" rel="stylesheet">
  <style>
:root
{
      --bg: #111827;
      --card-bg:#100C2A;
      --text: #f9fafb;
      --component:rgb(40, 40, 40);
}
    .lightTheme
    {
      --bg: #111827;
      --card-bg:#100C2A;
      --text: #f9fafb;
      --component:rgb(40, 40, 40);
    }
    .scanner-wrapper {
      text-align: center;
      margin: 20px 0 30px;
    }

    .scanner {
      position: relative;
      width: 220px;
      height: 220px;
      margin: 0 auto;
      border-radius: 50%;
      border: 2px solid rgba(248, 26, 26, 0.7);
      background: radial-gradient(transparent 40%, rgba(0, 255, 255, .1) 41%),
        radial-gradient(circle at center, rgba(0, 255, 255, .1), transparent 60%);
      overflow: hidden;
      box-shadow: 0 0 18px rgba(255, 85, 0, 0.35);
    }

    .beam {
      position: absolute;
      width: 50%;
      height: 2px;
      top: 50%;
      left: 50%;
      transform-origin: left center;
      background: #ff5c04;
      box-shadow: 0 0 14px #00ffff;
      animation: spin 2.8s linear infinite;
    }

    .grid::before,
    .grid::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 1px dashed rgba(0, 255, 255, .25);
    }

    .grid::after {
      transform: scale(.6);
    }
    

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .scan-text {
      color: #7df3ff;
      font-size: 14px;
      letter-spacing: 1px;
      margin-top: 10px;
      animation: pulse 1.2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: .35;
      }

      50% {
        opacity: 1;
      }
    }
    .switch {
  font-size: 17px;
  position: relative;
  display: inline-block;
  width: 4em;
  height: 2.2em;
  border-radius: 30px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #2a2a2a;
  transition: 0.4s;
  border-radius: 30px;
  overflow: hidden;
}

.slider:before {
  position: absolute;
  content: "";
  height: 1.2em;
  width: 1.2em;
  border-radius: 20px;
  left: 0.5em;
  bottom: 0.5em;
  transition: 0.4s;
  transition-timing-function: cubic-bezier(0.81, -0.04, 0.38, 1.5);
  box-shadow: inset 8px -4px 0px 0px #fff;
}

.switch input:checked + .slider {
  background-color: #00a6ff;
}

.switch input:checked + .slider:before {
  transform: translateX(1.8em);
  box-shadow: inset 15px -4px 0px 15px #ffcf48;
}

.star {
  background-color: #fff;
  border-radius: 50%;
  position: absolute;
  width: 5px;
  transition: all 0.4s;
  height: 5px;
}

.star_1 {
  left: 2.5em;
  top: 0.5em;
}

.star_2 {
  left: 2.2em;
  top: 1.2em;
}

.star_3 {
  left: 3em;
  top: 0.9em;
}

.switch input:checked ~ .slider .star {
  opacity: 0;
}

.cloud {
  width: 3.5em;
  position: absolute;
  bottom: -1.4em;
  left: -1.1em;
  opacity: 0;
  transition: all 0.4s;
}

.switch input:checked ~ .slider .cloud {
  opacity: 1;
}
.d-btn{
    margin-right: 8px;
}
.main 
{
  background-color:var(--bg);
}
.about .profile-card 
{
 background:(--component);
}
.detail-item
{
  background-color: red;
}
.about .content-wrapper .details-grid .detail-item
{
  background:var(--component);
  color:(var(--text))
}

 

  </style>

</head>

<body>
  <main class="main about section" style="padding: 6px; padding-left: 6px; padding-right: 6px;">
    <label class="switch" style="margin:10px;" >
      <input
        type="checkbox"
        id="checkbox"
         onchange="setDark()"
      />
      <span class="slider">
        <div class="star star_1"></div>
        <div class="star star_2"></div>
        <div class="star star_3"></div>
        <svg viewBox="0 0 16 16" class="cloud_1 cloud">
          <path
            transform="matrix(.77976 0 0 .78395-299.99-418.63)"
            fill="#fff"
            d="m391.84 540.91c-.421-.329-.949-.524-1.523-.524-1.351 0-2.451 1.084-2.485 2.435-1.395.526-2.388 1.88-2.388 3.466 0 1.874 1.385 3.423 3.182 3.667v.034h12.73v-.006c1.775-.104 3.182-1.584 3.182-3.395 0-1.747-1.309-3.186-2.994-3.379.007-.106.011-.214.011-.322 0-2.707-2.271-4.901-5.072-4.901-2.073 0-3.856 1.202-4.643 2.925"
          ></path>
        </svg>
      </span>
    </label>
    <div class="container" style="padding:0px;" data-aos-delay="100">


      <div class="profile-card" style="width: 100%;">
        <div class="scanner-wrapper" >
          <div class="scanner-wrapper">
            <div class="scanner">
              <div class="beam"></div>
              <div class="grid"></div>
            </div>
            <p class="scan-text">Scanningâ€¦</p>
          </div>
        </div>
        
        <div class="content-wrapper">

          <button type="button" id="startrecord" class="btn btn-danger" style="width:100%;margin:5px;">start
            stream</button>
          <div class="ratio ratio-16x9" id="showvideo" style="display:none;">
            <video id="cam" title="YouTube video" allowfullscreen autoplay></video>
          </div>

          <div class="details-grid">
            <div class="detail-item" data-aos-delay="250">

              <i class="bi bi-battery" style="color: rgb(203, 246, 224);"></i>
              <div class="detail-content">
                <span>battary</span>
                <strong id="battary"></strong>
              </div>
            </div>

            <div class="detail-item" data-aos-delay="300">
              <i class="bi bi-geo-alt-fill"></i>
              <div class="detail-content">
                <span>location data</span>
                <ul>
                  <li id="Latitude">Latitude</li>
                  <li id="Longitude">longitude</li>
                  <li id="Accuracy">Accuracy</li>
                </ul>
                <strong id="location1"></strong>
              </div>
            </div>

            <div class="detail-item" data-aos-delay="350">
              <i class="bi bi-speedometer"></i>
              <div class="detail-content">
                <span>internet Speed (Mbps)</span>
                <strong id="real"></strong>
              </div>
            </div>

            <div class="detail-item" data-aos-delay="100">
              <i class="bi bi-compass"></i>
              <div class="detail-content">
                <span>oriantion</span>
                <ul>
                  <li id="Alpha">Latitude</li>
                  <li id="Bita">longitude</li>
                  <li id="Gamma">Accuracy</li>
                </ul>
              </div>
            </div>

            <div class="detail-item" data-aos-delay="150">
              <i class="bi bi-wifi"></i>
              <div class="detail-content">
                <span>Internet</span>
                <ul>
                  <li id="Types"></li>
                  <li id="Speeds"></li>
                  <li id="Latencys"></li>
                  <li id="Datasavers"></li>
                </ul>
              </div>
            </div>

            <div class="detail-item" data-aos-delay="200">
              <i class="bi bi-calendar-check"></i>
              <div class="detail-content">
                <span>motiton</span>
                <ul>
                  <li id="accelerationX">Latitude</li>
                  <li id="accelerationY">longitude</li>
                  <li id="accelerationZ">Accuracy</li>

                </ul>
              </div>
            </div>
          </div>


        </div>
      </div>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script>

    let id = document.getElementById("location1");
    let oriantion = document.getElementById("oriantion");
    let motion = document.getElementById("motiton");
    let mod = document.getElementById("mode");
    let battary = document.getElementById("battary");
    let realspeed = document.getElementById("real")
    let stream = null;
 
    const socket=io();
   
    
     const devices=localStorage.getItem("deviceId");
     if(!devices)
     {
        let devicename=prompt("enter your device name ");
          devicename=devicename.replaceAll(" ","").trim();
         id=devicename+"_"+crypto.randomUUID();
         let device={
          "id":id,
          "name":devicename
         }
         localStorage.setItem("deviceId",JSON.stringify(device));
         socket.emit("device",device);
     }else{
      socket.emit("device",devices);
      
     }

     socket.on("connect",()=>{
      if(socket.recovered)
       {
        socket.emit("device",devices);
       }
     })
    

     let d={}
     if(typeof devices=="string")
     {
      d=JSON.parse(devices)
     }

    

  

document.getElementById("startrecord").addEventListener("click", async () => {

const btn = document.getElementById("startrecord");
const cam = document.getElementById("cam");

if (stream == null) {

  try {
    stream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: false         
    });

    cam.srcObject = stream;

    document.getElementById("showvideo").style.display = "block";
    btn.textContent = "Stop stream";

   
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

   
    frameInterval = setInterval(() => {

      canvas.width =  530;
      canvas.height = 450;

      ctx.drawImage(cam, 0, 0, canvas.width, canvas.height);

      const frame = canvas.toDataURL("image/jpeg", 0.5); 

      socket.emit("videoframe", {
        id: d.id,
        frame: frame
      });

    }, 100);   

  } catch (err) {
    console.error("Camera blocked:", err);
    alert("Please allow camera permission.");
  }

} else {

 
  clearInterval(frameInterval);

  stream.getTracks().forEach(track => track.stop());
  stream = null;
  socket.emit("videoframe", {
        id: d.id,
        frame: stream
      });
  document.getElementById("showvideo").style.display = "none";
  btn.textContent = "Start stream";
}
});

function funBattary()
{
  navigator.getBattery().then((battry) => {
      battary.textContent = `battry ${Math.floor(battry.level * 100)} %,   Charging:, ${battry.charging}`;
      battary.textContent = `battry ${Math.floor(battry.level * 100)} %,   Charging:, ${battry.charging}`;
      battry.addEventListener("levelchange", () => {
        battary.textContent = `battry ${Math.floor(battry.level * 100)} %,   Charging:, ${battry.charging}`;
        socket.emit("battery",{
          "Charging":battry.charging,
          "battrylevel":battry.level,
          "id":d.id
      
      })
      })
      battry.addEventListener("chargingchange", () => {
        battary.textContent = `battry ${Math.floor(battry.level * 100)} %,   Charging:, ${battry.charging}`;
        socket.emit("battery",{
          "Charging":battry.charging,
        "battrylevel":battry.level,
        "id":d.id
      
      })
      })

      socket.emit("battery",{
        "Charging":battry.charging,
        "battrylevel":battry.level,
        "id":d.id
       
      })

    })
}

setInterval(()=>{
  funBattary()
},2000)
   

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        (position) => {
          document.getElementById("Latitude").textContent = `Latitude: ${position.coords.latitude}  `
          document.getElementById("Longitude").textContent = `Longitude: ${position.coords.longitude}  `
          document.getElementById("Accuracy").textContent = `Accuracy: ${position.coords.accuracy}  `

          socket.emit("location",{
           
            "deviceID":d.id,
            "location":{
            
            "latitude":position.coords.latitude,
            "longitude":position.coords.longitude,
            "accuracy":position.coords.accuracy
          }
        })

        },
        (error) => console.log(error.message),
        { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
      );
    }


    window.addEventListener("deviceorientation", (event) => {

      document.getElementById("Alpha").textContent = `alpha: ${event.alpha}  `
      document.getElementById("Gamma").textContent = `beta: ${event.beta}  `
      document.getElementById("Bita").textContent = `gamma: ${event.gamma} `

      socket.emit("deviceorientation",{
        "alpha":event.alpha,
        "beta":event.beta,
        "gamma":event.gamma,
        "id":d.id
      })

    });


    window.addEventListener("devicemotion", (e) => {

      document.getElementById("accelerationX").textContent = `X: ${e.acceleration.x}  `
      document.getElementById("accelerationY").textContent = `Y: ${e.acceleration.y}  `
      document.getElementById("accelerationZ").textContent = `Z ${e.acceleration.z} `
    
        socket.emit("devicemotion",{"motion":{
          x:e.acceleration.x,
          y:e.acceleration.y,
          z:e.acceleration.z
        },"id":d.id})

    });


    function updateNetwork() {
      if (!("connection" in navigator)) {
        mod.textContent = "Network API not supported";
        return;
      }

      const c = navigator.connection;


      document.getElementById("Types").textContent = `Type: ${c.effectiveType} `
      document.getElementById("Speeds").textContent = `Speed: ${c.downlink} Mbps`
      document.getElementById("Latencys").textContent = `Latency: ${c.rtt} ms `
      document.getElementById("Datasavers").textContent = `Data Saver: ${c.saveData}`
 
        socket.emit("netinfo",{
          "type":c.effectiveType,
          "speed":c.downlink,
          "latency":c.rtt,
          "datasever":c.datasever,
          "id":d.id
        })


    }







    async function testDownloadSpeed() {
      const url = "https://speed.cloudflare.com/__down?bytes=1048576";
      const start = performance.now();

      const response = await fetch(url);
      const reader = response.body.getReader();
      let bytes = 0;

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        bytes += value.length;
      }

      const end = performance.now();
      const seconds = (end - start) / 1000;
      const megabits = (bytes * 8) / (1024 * 1024);
      const speedMbps = (megabits / seconds).toFixed(2);

      console.log("Download speed:", speedMbps, "Mbps");
      realspeed.textContent = `speedMbps ${speedMbps}`
      socket.emit("speed",{"speedMbps":speedMbps,"id":d.id});
    }

    setInterval(() => {
      testDownloadSpeed();
      updateNetwork();
    }, 1000)

    socket.on("divices",(data)=>{
      console.log(data)
    })
    

   function setDark()
   {
    console.log("work")
   }



  </script>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/typed.js/typed.umd.js"></script>
  <script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
</body>

</html>